<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow 
	keyUp="keyHandler(event);" 
	xmlns:mx="http://www.adobe.com/2006/mxml" 
	title="Database Connection Properties" 
	close="closeWin(event);" 
	creationComplete="init();" 
	layout="absolute" 
	width="314" 
	height="190">
	
	<mx:Script>
		<![CDATA[
			import com.flexsqladmin.sqladmin.model.ModelLocator;
		
			import mx.managers.PopUpManager;
			import com.flexsqladmin.sqladmin.vo.ConnectionVO;
			import com.flexsqladmin.sqladmin.events.LoginEvent;
			import com.adobe.cairngorm.control.CairngormEventDispatcher;
			import com.flexsqladmin.sqladmin.components.DebugWindow;
			
			private var model:ModelLocator = ModelLocator.getInstance();
			private var resultlimit:int;
			
			public function init():void{
				
        		PopUpManager.centerPopUp(this);
        		username.setFocus();
        		
        		if (Number(parentApplication.parameters.resultlimit) && parentApplication.parameters.resultlimit > 0)
            		model.tempConnectionVO.toomany = parentApplication.parameters.resultlimit;
            		
				server.text = parentApplication.parameters.server;
				database.text = parentApplication.parameters.database;
				username.text = parentApplication.parameters.username;
				password.text = parentApplication.parameters.password;
   			}
   			
   			public function closeWin(e:Event):void{
        		PopUpManager.removePopUp(this);
        	}
        	
        	public function setProperties():void{
        		DebugWindow.log("login.mxml:setProperties()");
        		
				model.tempConnectionVO.username = username.text;
            	model.tempConnectionVO.password = password.text;
            	model.tempConnectionVO.server = server.text;
            	model.tempConnectionVO.database = database.text;
            	
				var event:LoginEvent = new LoginEvent("select '' from (values (1))", "normal", this);
            	CairngormEventDispatcher.getInstance().dispatchEvent(event);
            	
				loginbtn.enabled = false;
        	}
            
            private function keyHandler(e:KeyboardEvent):void{
               	// Submit form on enter
                if(e.keyCode == 13)
                	setProperties();
            }
            
		]]>
	</mx:Script>
	
	<mx:Label x="34" y="12" text="Username"/>
	<mx:Label x="40" y="38" text="Password"/>
	<mx:Label x="56" y="64" text="Server"/>
	<mx:Label x="38" y="92" text="Database"/>
	<mx:TextInput x="104" y="10" id="username" text=""/>
	<mx:TextInput x="104" y="36" id="password" text="" displayAsPassword="true"/>
	<mx:TextInput x="104" y="62" id="server" text=""/>
	<mx:TextInput x="104" y="90" id="database" text=""/>
	<mx:Button id="loginbtn" x="104" y="118" label="Login" click="setProperties();"/>
	
</mx:TitleWindow>
